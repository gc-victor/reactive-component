var B;(function(n){n[n.None=0]="None",n[n.Mutable=1]="Mutable",n[n.Watching=2]="Watching",n[n.RecursedCheck=4]="RecursedCheck",n[n.Recursed=8]="Recursed",n[n.Dirty=16]="Dirty",n[n.Pending=32]="Pending"})(B||(B={}));function R({update:n,notify:e,unwatched:t}){return{link:s,unlink:r,propagate:p,checkDirty:E,endTracking:l,startTracking:d,shallowPropagate:T};function s(i,o){let u=o.depsTail;if(u!==void 0&&u.dep===i)return;let a,c=o.flags&4;if(c&&(a=u!==void 0?u.nextDep:o.deps,a!==void 0&&a.dep===i)){o.depsTail=a;return}let h=i.subsTail;if(h!==void 0&&h.sub===o&&(!c||f(h,o)))return;let g=o.depsTail=i.subsTail={dep:i,sub:o,prevDep:u,nextDep:a,prevSub:h,nextSub:void 0};a!==void 0&&(a.prevDep=g),u!==void 0?u.nextDep=g:o.deps=g,h!==void 0?h.nextSub=g:i.subs=g}function r(i,o=i.sub){let u=i.dep,a=i.prevDep,c=i.nextDep,h=i.nextSub,g=i.prevSub;return c!==void 0?c.prevDep=a:o.depsTail=a,a!==void 0?a.nextDep=c:o.deps=c,h!==void 0?h.prevSub=g:u.subsTail=g,g!==void 0?g.nextSub=h:(u.subs=h)===void 0&&t(u),c}function p(i){let o=i.nextSub,u;e:do{let a=i.sub,c=a.flags;if(c&3&&(c&60?c&12?c&4?!(c&48)&&f(i,a)?(a.flags=c|40,c&=1):c=0:a.flags=c&-9|32:c=0:a.flags=c|32,c&2&&e(a),c&1)){let h=a.subs;if(h!==void 0){i=h,h.nextSub!==void 0&&(u={value:o,prev:u},o=i.nextSub);continue}}if((i=o)!==void 0){o=i.nextSub;continue}for(;u!==void 0;)if(i=u.value,u=u.prev,i!==void 0){o=i.nextSub;continue e}break}while(!0)}function d(i){i.depsTail=void 0,i.flags=i.flags&-57|4}function l(i){let o=i.depsTail,u=o!==void 0?o.nextDep:i.deps;for(;u!==void 0;)u=r(u,i);i.flags&=-5}function E(i,o){let u,a=0;e:do{let c=i.dep,h=c.flags,g=!1;if(o.flags&16)g=!0;else if((h&17)===17){if(n(c)){let S=c.subs;S.nextSub!==void 0&&T(S),g=!0}}else if((h&33)===33){(i.nextSub!==void 0||i.prevSub!==void 0)&&(u={value:i,prev:u}),i=c.deps,o=c,++a;continue}if(!g&&i.nextDep!==void 0){i=i.nextDep;continue}for(;a;){--a;let S=o.subs,P=S.nextSub!==void 0;if(P?(i=u.value,u=u.prev):i=S,g){if(n(o)){P&&T(S),o=i.sub;continue}}else o.flags&=-33;if(o=i.sub,i.nextDep!==void 0){i=i.nextDep;continue e}g=!1}return g}while(!0)}function T(i){do{let o=i.sub,u=i.nextSub,a=o.flags;(a&48)===32&&(o.flags=a|16,a&2&&e(o)),i=u}while(i!==void 0)}function f(i,o){let u=o.depsTail;if(u!==void 0){let a=o.deps;do{if(a===i)return!0;if(a===u)break;a=a.nextDep}while(a!==void 0)}return!1}}var L=[],{link:I,unlink:D,propagate:z,checkDirty:V,endTracking:H,startTracking:w,shallowPropagate:O}=R({update(n){return"getter"in n?Y(n):W(n,n.value)},notify:X,unwatched(n){if("getter"in n){let e=n.deps;if(e!==void 0){n.flags=17;do e=D(e,n);while(e!==void 0)}}else"previousValue"in n||F.call(n)}}),Z=0,C=0,A=0,b,y;function N(n){let e=b;return b=n,e}function U(n){return te.bind({previousValue:n,value:n,subs:void 0,subsTail:void 0,flags:1})}function $(n){return ee.bind({value:void 0,subs:void 0,subsTail:void 0,deps:void 0,depsTail:void 0,flags:17,getter:n})}function G(n){let e={fn:n,subs:void 0,subsTail:void 0,deps:void 0,depsTail:void 0,flags:2};b!==void 0?I(e,b):y!==void 0&&I(e,y);let t=N(e);try{e.fn()}finally{N(t)}return F.bind(e)}function Y(n){let e=N(n);w(n);try{let t=n.value;return t!==(n.value=n.getter(t))}finally{N(e),H(n)}}function W(n,e){return n.flags=1,n.previousValue!==(n.previousValue=e)}function X(n){let e=n.flags;if(!(e&64)){n.flags=e|64;let t=n.subs;t!==void 0?X(t.sub):L[A++]=n}}function j(n,e){if(e&16||e&32&&V(n.deps,n)){let s=N(n);w(n);try{n.fn()}finally{N(s),H(n)}return}else e&32&&(n.flags=e&-33);let t=n.deps;for(;t!==void 0;){let s=t.dep,r=s.flags;r&64&&j(s,s.flags=r&-65),t=t.nextDep}}function Q(){for(;C<A;){let n=L[C];L[C++]=void 0,j(n,n.flags&=-65)}C=0,A=0}function ee(){let n=this.flags;if(n&16||n&32&&V(this.deps,this)){if(Y(this)){let e=this.subs;e!==void 0&&O(e)}}else n&32&&(this.flags=n&-33);return b!==void 0?I(this,b):y!==void 0&&I(this,y),this.value}function te(...n){if(n.length){let e=n[0];if(this.value!==(this.value=e)){this.flags=17;let t=this.subs;t!==void 0&&(z(t),Z||Q())}}else{let e=this.value;if(this.flags&16&&W(this,e)){let t=this.subs;t!==void 0&&O(t)}return b!==void 0&&I(this,b),e}}function F(){let n=this.deps;for(;n!==void 0;)n=D(n,this);let e=this.subs;e!==void 0&&D(e),this.flags=0}var ne="reactive-component-context-",se="$ref",ie="$state",v="$bind-",k="on",_="value",re="text",q="html",x="checked",oe="disabled",ae="class";var J="state",ue="attr",K="checkbox",m="radio",de="number",ce="range",fe="input",pe="change",le="add",he="remove",Te="replace",ge="toggle",Ee="class";var be=n=>`Cannot expose context "${n}": state or computed value not found`,ve=n=>`Context "${n}" not found in any parent component`,Se=n=>`Computed property "${n}" is being redefined`,Ne=n=>`The checkbox ${n} has ${v}${_} attribute, use ${v}${x} instead.`,_e=n=>`The radio ${n} has ${v}${x} attribute, use ${v}${_} instead.`,xe=(n,e)=>`Invalid binding ${n} value "${e}": must only contain alphanumeric characters`,Ie=(n,e)=>`Invalid binding type "${n}" in attribute "${e}": must only contain alphanumeric characters or hyphens`,Ce="Event binding requires event name and handler",ye=n=>`Handler method "${n}" not found or not a function`;function Pe(n){let e=`${ne}${n}`;return{id:Symbol(e),eventName:e,state:n}}var M=class n extends HTMLElement{state=new Map;exposedContexts=new Set;contextSubscriptions=new Map;derived=new Map;bindings=new Map;observers=new Map;stateElements=new Map;refs={};constructor(){super(),this.processElement=this.processElement.bind(this),this.handleStateChange=this.handleStateChange.bind(this)}connectedCallback(){this.processChildren(this),this.setupMutationObserver()}exposeContext(e){let t=e.state;if(!this.state.has(t)&&!this.derived.has(t)){console.warn(be(t));return}this.exposedContexts.add(e.id),this.effect(()=>{let s=this.getState(t);this.broadcastContextUpdate(e,s)})}broadcastContextUpdate(e,t){let s=e.state,r=new CustomEvent(e.eventName,{bubbles:!0,composed:!0,detail:{key:s,value:t,source:this}});this.dispatchEvent(r)}consumeContext(e){let t=e.state,s=this.findContextProvider(e);if(!s){console.warn(ve(t));return}let r=s.getState(t);this.setState(t,r);let p=this.subscribeToContextUpdates(e,s,d=>{let l=this.state.get(t);l&&(l(d),this.handleStateChange(t))});this.contextSubscriptions.set(t,p)}findContextProvider(e){let t=this.parentElement;for(;t;){if(t instanceof n&&t.exposedContexts&&t.exposedContexts.has(e.id))return t;t=t.parentElement}return null}subscribeToContextUpdates(e,t,s){let r=e.state,p=d=>{let E=d.detail;E.key===r&&E.source===t&&s(E.value)};return t.addEventListener(e.eventName,p),()=>{t.removeEventListener(e.eventName,p)}}disconnectedCallback(){for(let e of this.observers.values())e.disconnect();this.observers.clear();for(let e of this.contextSubscriptions.values())e();this.contextSubscriptions.clear()}setState(e,t){let s=this.coerceValue(t);if(!this.state.has(e))this.state.set(e,U(s)),this.defineStateProperty(e);else{let r=this.state.get(e);r&&r()!==s&&(r(s),this.handleStateChange(e))}}getState(e){return this.state.get(e)?.()??this.derived.get(e)?.()??null}defineStateProperty(e){Object.defineProperty(this,e,{get:()=>this.getState(e),set:t=>this.setState(e,t),configurable:!0,enumerable:!0})}compute(e,t,s){this.derived.has(e)&&console.warn(Se(e));let r=$(()=>{let p=t.map(l=>this.getState(l)),d=s(...p);return this.coerceValue(d)});this.derived.set(e,r),this.effect(()=>{let p=r();this.updateBindingsForKey(e,p)})}updateBindingsForKey(e,t){let s=this.bindings.get(e);if(s)for(let{element:r,type:p}of s)this.updateBinding(e,r,p,t)}effect(e){return G(e)}processChildren(e){let t=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>r.tagName.includes("-")&&r!==this?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}),s=t.nextNode();for(;s;)this.processElement(s),s=t.nextNode()}processElement(e){for(let t of Array.from(e.attributes)){let{name:s,value:r}=t;if(!/^[a-zA-Z0-9]+$/.test(r)&&s.startsWith("$")){console.error(xe(s,r));continue}if(s===se)this.refs[r]=e,e.removeAttribute(s);else if(s===ie){let d=r;this.stateElements.set(d,e);let l=e.hasAttribute(v+q),E=this.coerceValue(l?e.innerHTML:e.textContent);this.setState(d,E),this.addBinding(d,e,J),e.removeAttribute(s)}else if(s.startsWith(v)){let d=s.replace(v,"");if(!/^[a-zA-Z0-9-]+$/.test(d)){console.error(Ie(d,s));continue}let E=r;this.addBinding(E,e,d),e.removeAttribute(s)}else if(s.startsWith(k)){let d=s.slice(k.length);if(!d||!r){console.error(Ce);continue}let l=r,E=T=>{let f=this[l];if(typeof f!="function"){console.error(ye(l));return}f.call(this,T)};e.addEventListener(d,E),e.removeAttribute(s)}}}coerceValue(e){if(e!=null){if(e==="")return e;if(e==="false"||e==="true")return e==="true";if(typeof e=="string"){let t=Number(e);if(!Number.isNaN(t))return t;try{let s=JSON.parse(e);if(Array.isArray(s)||typeof s=="object")return s}catch{return e}}return e}}addBinding(e,t,s){this.bindings.has(e)||this.bindings.set(e,new Set);let r=this.bindings.get(e);if(r&&r.add({element:t,type:s}),(t instanceof HTMLInputElement||t instanceof HTMLSelectElement||t instanceof HTMLTextAreaElement)&&(s===_||s===x)){let p=()=>{let d=t.value;if(t instanceof HTMLInputElement){let l=t.type;if(l===K)s===x?d=t.checked:s===_&&console.warn(Ne(t));else if(l===m){if(s===x)console.warn(_e(t));else if(s===_&&t.checked){this.setState(e,t.value);return}return}else l===de||l===ce?d=Number(t.valueAsNumber):d=t.value}else t instanceof HTMLSelectElement?t.multiple?d=Array.from(t.selectedOptions).map(l=>l.value):d=t.value:t instanceof HTMLTextAreaElement&&(d=t.value);this.setState(e,d)};(t instanceof HTMLSelectElement||t instanceof HTMLInputElement&&[K,m].includes(t.type))&&t.addEventListener(pe,p),t.addEventListener(fe,p)}this.updateBinding(e,t,s,this.getState(e))}formatValue(e){return e==null?"":typeof e=="object"?JSON.stringify(e):String(e)}updateBinding(e,t,s,r){let p=this.formatValue(r),d={[J]:()=>{this.stateElements.has(e)&&(t.textContent=p)},[_]:()=>{if("value"in t){if(t instanceof HTMLInputElement&&t.type===m){if(p){let T=this.querySelectorAll(`input[type="${m}"][name="${t.name}"]`);for(let f of Array.from(T))f instanceof HTMLInputElement&&(f.checked=f.value===p)}return}t.value=p}},[re]:()=>{t.textContent=p},[q]:()=>{t.innerHTML=p},[x]:()=>{"checked"in t&&(t.checked=!!r)},[oe]:()=>{"disabled"in t&&(t.disabled=!!r)},[ae]:()=>{if(!(!r||typeof r!="object")){for(let[T,f]of Object.entries(r))T===le||T===he?Array.isArray(f)?t.classList[T](...f):t.classList[T](f):T===Te&&Array.isArray(f)&&f.length===2?t.classList.replace(f[0],f[1]):T===ge&&(typeof f=="string"?t.classList.toggle(f):typeof f=="object"&&t.classList.toggle(f.key,f.value));t.classList.length===0&&t.removeAttribute(Ee)}},[ue]:()=>{if(typeof r=="string")t.removeAttribute(r);else if(typeof r=="object"&&r!==null)for(let[T,f]of Object.entries(r))f===null||f===!1?t.removeAttribute(T):t.setAttribute(T,f===!0?"":String(f))}},l=this.customBindingHandlers({stateKey:e,element:t,formattedValue:p,rawValue:r});({...d,...l})[s]?.()}customBindingHandlers({stateKey:e,element:t,formattedValue:s,rawValue:r}){return{}}handleStateChange(e){let t=this.getState(e),s=this.bindings.get(e);if(s)for(let{element:r,type:p}of s)this.updateBinding(e,r,p,t)}setupMutationObserver(){let e=new MutationObserver(t=>{for(let s of t)for(let r of Array.from(s.addedNodes))r instanceof HTMLElement&&this.processChildren(r)});e.observe(this,{childList:!0,subtree:!0}),this.observers.set(this,e)}};typeof window<"u"&&(window.ReactiveComponent=M);export{M as ReactiveComponent,Pe as createContext};
